
<!doctype html>
<html lang="zh" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../PX4/">
      
      
        <link rel="next" href="../ROS2/">
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.22">
    
    
      
        <title>Gazebo 仿真 - PX4无人机项目文档</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.84d31ad4.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#1-px4" class="md-skip">
          跳转至
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="页眉">
    <a href=".." title="PX4无人机项目文档" class="md-header__button md-logo" aria-label="PX4无人机项目文档" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            PX4无人机项目文档
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Gazebo 仿真
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="切换到暗色模式"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="切换到暗色模式" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6m0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4M7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="切换到亮色模式"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="切换到亮色模式" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="搜索" placeholder="搜索" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="查找">
        
        <button type="reset" class="md-search__icon md-icon" title="清空当前内容" aria-label="清空当前内容" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            正在初始化搜索引擎
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="标签" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href=".." class="md-tabs__link">
        
  
  
    
  
  主页

      </a>
    </li>
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../1.%20%E7%B3%BB%E7%BB%9F%E6%9E%B6%E6%9E%84/" class="md-tabs__link">
          
  
  
  系统设计

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../3.%20%E5%85%B3%E9%94%AE%E6%A8%A1%E5%9D%97%E8%AF%A6%E8%A7%A3/" class="md-tabs__link">
          
  
  
  关键模块

        </a>
      </li>
    
  

      
        
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../ROS1/" class="md-tabs__link">
          
  
  
  环境与安装 (主线)

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../ROS2/" class="md-tabs__link">
          
  
  
  备选方案 (ROS 2)

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="导航栏" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="PX4无人机项目文档" class="md-nav__button md-logo" aria-label="PX4无人机项目文档" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    PX4无人机项目文档
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    主页
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    系统设计
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            系统设计
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../1.%20%E7%B3%BB%E7%BB%9F%E6%9E%B6%E6%9E%84/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    系统架构
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../2.%20%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF%E6%A0%88/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    核心技术栈
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../4.%20%E4%BB%BF%E7%9C%9F%E4%B8%8E%E6%B5%8B%E8%AF%95/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    仿真与测试
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../SITL%20%28Software-In-The-Loop%29/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    SITL
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    关键模块
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            关键模块
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../3.%20%E5%85%B3%E9%94%AE%E6%A8%A1%E5%9D%97%E8%AF%A6%E8%A7%A3/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    模块总览
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Aruco%20%E8%A7%86%E8%A7%89%E5%AE%9A%E4%BD%8D/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Aruco 定位
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../%E5%8F%B7%E7%89%8C%E8%AF%86%E5%88%AB%E6%A8%A1%E5%9E%8B/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    号牌识别
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../%E8%87%AA%E4%B8%BB%E6%8E%A7%E5%88%B6%E9%80%BB%E8%BE%91/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    控制逻辑
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
      
        
        
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" checked>
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    环境与安装 (主线)
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            环境与安装 (主线)
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ROS1/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    ROS 1
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../MAVROS/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    MAVROS
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../PX4/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    PX4 飞控
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Gazebo 仿真
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Gazebo 仿真
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目录
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#1-px4" class="md-nav__link">
    <span class="md-ellipsis">
      1. 下载 PX4 源码
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-ubuntu" class="md-nav__link">
    <span class="md-ellipsis">
      2. 运行 Ubuntu 安装脚本
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3" class="md-nav__link">
    <span class="md-ellipsis">
      3. 重启计算机
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4" class="md-nav__link">
    <span class="md-ellipsis">
      4. 更新子模块和依赖
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#5" class="md-nav__link">
    <span class="md-ellipsis">
      5. 构建并运行仿真
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#6-gazebo" class="md-nav__link">
    <span class="md-ellipsis">
      6. 下载Gazebo官方模型
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#7-troubleshooting" class="md-nav__link">
    <span class="md-ellipsis">
      7. 常见问题 (Troubleshooting)
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#gazeboros" class="md-nav__link">
    <span class="md-ellipsis">
      Gazebo和ROS的桥接
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Gazebo和ROS的桥接">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-gazebo-ros" class="md-nav__link">
    <span class="md-ellipsis">
      1. 安装 Gazebo-ROS 桥接包
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-sourcing" class="md-nav__link">
    <span class="md-ellipsis">
      2. 设置环境变量 (Sourcing)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2. 设置环境变量 (Sourcing)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#sourcing-ros" class="md-nav__link">
    <span class="md-ellipsis">
      Sourcing ROS 环境
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-px4" class="md-nav__link">
    <span class="md-ellipsis">
      3. 关键的 PX4 路径配置
    </span>
  </a>
  
    <nav class="md-nav" aria-label="3. 关键的 PX4 路径配置">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#31-sourcing-gazebo" class="md-nav__link">
    <span class="md-ellipsis">
      3.1 Sourcing Gazebo 设置脚本
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#32-ros-ros_package_path" class="md-nav__link">
    <span class="md-ellipsis">
      3.2 配置 ROS 包路径 (ROS_PACKAGE_PATH)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#33-4bashrc" class="md-nav__link">
    <span class="md-ellipsis">
      3.3 若第4步成功，可将以下内容写入~/.bashrc中（可选，强烈推荐）
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-gazeborosmavros" class="md-nav__link">
    <span class="md-ellipsis">
      4. 启动仿真（以下步骤不仅能实现Gazebo与ROS话题桥接还可以同时启动MAVROS）
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#px4" class="md-nav__link">
    <span class="md-ellipsis">
      PX4 自定义模型仿真全流程总结
    </span>
  </a>
  
    <nav class="md-nav" aria-label="PX4 自定义模型仿真全流程总结">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    <span class="md-ellipsis">
      核心理念：理解“身体”与“大脑”的分离
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    <span class="md-ellipsis">
      第一阶段：创建自定义模型 (三步走)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="第一阶段：创建自定义模型 (三步走)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-the-body" class="md-nav__link">
    <span class="md-ellipsis">
      步骤 1：创建物理模型 (The Body)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-the-brain" class="md-nav__link">
    <span class="md-ellipsis">
      步骤 2：创建飞控配置 (The Brain)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3px4" class="md-nav__link">
    <span class="md-ellipsis">
      步骤 3：向PX4编译系统“注册”新模型
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    <span class="md-ellipsis">
      第二阶段：问题排查之旅
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    备选方案 (ROS 2)
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            备选方案 (ROS 2)
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ROS2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    ROS 2
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../MAVSDK/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    MAVSDK
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目录
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#1-px4" class="md-nav__link">
    <span class="md-ellipsis">
      1. 下载 PX4 源码
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-ubuntu" class="md-nav__link">
    <span class="md-ellipsis">
      2. 运行 Ubuntu 安装脚本
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3" class="md-nav__link">
    <span class="md-ellipsis">
      3. 重启计算机
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4" class="md-nav__link">
    <span class="md-ellipsis">
      4. 更新子模块和依赖
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#5" class="md-nav__link">
    <span class="md-ellipsis">
      5. 构建并运行仿真
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#6-gazebo" class="md-nav__link">
    <span class="md-ellipsis">
      6. 下载Gazebo官方模型
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#7-troubleshooting" class="md-nav__link">
    <span class="md-ellipsis">
      7. 常见问题 (Troubleshooting)
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#gazeboros" class="md-nav__link">
    <span class="md-ellipsis">
      Gazebo和ROS的桥接
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Gazebo和ROS的桥接">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-gazebo-ros" class="md-nav__link">
    <span class="md-ellipsis">
      1. 安装 Gazebo-ROS 桥接包
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-sourcing" class="md-nav__link">
    <span class="md-ellipsis">
      2. 设置环境变量 (Sourcing)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2. 设置环境变量 (Sourcing)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#sourcing-ros" class="md-nav__link">
    <span class="md-ellipsis">
      Sourcing ROS 环境
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-px4" class="md-nav__link">
    <span class="md-ellipsis">
      3. 关键的 PX4 路径配置
    </span>
  </a>
  
    <nav class="md-nav" aria-label="3. 关键的 PX4 路径配置">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#31-sourcing-gazebo" class="md-nav__link">
    <span class="md-ellipsis">
      3.1 Sourcing Gazebo 设置脚本
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#32-ros-ros_package_path" class="md-nav__link">
    <span class="md-ellipsis">
      3.2 配置 ROS 包路径 (ROS_PACKAGE_PATH)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#33-4bashrc" class="md-nav__link">
    <span class="md-ellipsis">
      3.3 若第4步成功，可将以下内容写入~/.bashrc中（可选，强烈推荐）
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-gazeborosmavros" class="md-nav__link">
    <span class="md-ellipsis">
      4. 启动仿真（以下步骤不仅能实现Gazebo与ROS话题桥接还可以同时启动MAVROS）
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#px4" class="md-nav__link">
    <span class="md-ellipsis">
      PX4 自定义模型仿真全流程总结
    </span>
  </a>
  
    <nav class="md-nav" aria-label="PX4 自定义模型仿真全流程总结">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    <span class="md-ellipsis">
      核心理念：理解“身体”与“大脑”的分离
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    <span class="md-ellipsis">
      第一阶段：创建自定义模型 (三步走)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="第一阶段：创建自定义模型 (三步走)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-the-body" class="md-nav__link">
    <span class="md-ellipsis">
      步骤 1：创建物理模型 (The Body)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-the-brain" class="md-nav__link">
    <span class="md-ellipsis">
      步骤 2：创建飞控配置 (The Brain)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3px4" class="md-nav__link">
    <span class="md-ellipsis">
      步骤 3：向PX4编译系统“注册”新模型
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    <span class="md-ellipsis">
      第二阶段：问题排查之旅
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<blockquote>
<p>[!WARNING] <strong>强烈建议使用 Ubuntu 20.04 (Focal Fossa)</strong> 本构建流程在 Ubuntu 20.04 上经过完整测试。使用其他版本（如 22.04）可能会因为 Gazebo 版本不兼容、依赖库缺失等问题导致构建失败。</p>
</blockquote>
<p>这是从 <a href="../PX4/">PX4</a> 源码在 Ubuntu (Linux) 上构建 <a href="../SITL%20%28Software-In-The-Loop%29/">SITL (Software-In-The-Loop)</a> 仿真环境的详细步骤。</p>
<h2 id="1-px4">1. 下载 PX4 源码</h2>
<p>确保已安装 <code>git</code>。然后克隆 <code>PX4-Autopilot</code> 仓库，注意需要 <code>--recursive</code> 参数来下载所有子模块。</p>
<div class="highlight"><pre><span></span><code>git<span class="w"> </span>clone<span class="w"> </span>https://github.com/PX4/PX4-Autopilot.git<span class="w"> </span>--recursive
</code></pre></div>
<h2 id="2-ubuntu">2. 运行 Ubuntu 安装脚本</h2>
<p>PX4 源码中提供了一个方便的设置脚本，它会自动安装包括 <a href="./">Gazebo 仿真</a> (Classic 11) 在内的大部分依赖。</p>
<div class="highlight"><pre><span></span><code>bash<span class="w"> </span>./PX4-Autopilot/Tools/setup/ubuntu.sh<span class="w"> </span>--no-nuttx
</code></pre></div>
<h2 id="3">3. 重启计算机</h2>
<p>安装完成后，需要重启以使所有更改生效。</p>
<div class="highlight"><pre><span></span><code>sudo<span class="w"> </span>reboot
</code></pre></div>
<h2 id="4">4. 更新子模块和依赖</h2>
<p>重启后，进入源码目录，再次确保子模块已更新，并安装一些额外的编译依赖。</p>
<div class="highlight"><pre><span></span><code><span class="c1"># 进入源码目录</span>
<span class="nb">cd</span><span class="w"> </span>PX4-Autopilot

<span class="c1"># 更新子模块</span>
git<span class="w"> </span>submodule<span class="w"> </span>update<span class="w"> </span>--init<span class="w"> </span>--recursive<span class="w">  </span>

<span class="c1"># 下载 protobuf, eigen, opencv 等依赖</span>
sudo<span class="w"> </span>apt-get<span class="w"> </span>install<span class="w"> </span>protobuf-compiler<span class="w"> </span>libeigen3-dev<span class="w"> </span>libopencv-dev<span class="w"> </span>-y
</code></pre></div>
<h2 id="5">5. 构建并运行仿真</h2>
<p>最后，编译 <code>px4_sitl_default</code> 目标，并指定 <code>gazebo</code> 作为后端。</p>
<div class="highlight"><pre><span></span><code><span class="c1"># 进入源码目录</span>
<span class="nb">cd</span><span class="w"> </span>PX4-Autopilot

make<span class="w"> </span>px4_sitl_default<span class="w"> </span>gazebo
</code></pre></div>
<p>如果一切顺利，Gazebo 窗口将会启动，无人机模型会出现在仿真世界中。</p>
<h2 id="6-gazebo">6. 下载Gazebo官方模型</h2>
<p><a href="https://www.bilibili.com/video/BV143411C75B?spm_id_from=333.788.videopod.episodes&amp;vd_source=e35fecf3ad19c6e478d062509b67923d&amp;p=2">第二讲的2~4分钟有教学</a></p>
<blockquote>
<p><strong>由于PX4官方有一些与Gazebo官方同名的模型，因此需修改Gazebo官方的同名模型名称</strong>（通常你启动PX4仿真如果遇到模型不匹配，就要检查下这种情况）
PX4官方模型和世界文件可分别在<code>PX4-Autopilot/Tools/simulation/gazebo-classic/sitl_gazebo-classic/models/</code>和<code>PX4-Autopilot/Tools/simulation/gazebo-classic/sitl_gazebo-classic/worlds/</code>找到</p>
</blockquote>
<p><strong>视频中gitee网址错误，这个才是正确的：</strong><code>https://gitee.com/bingda-robot/gazebo_models.git</code></p>
<h2 id="7-troubleshooting">7. 常见问题 (Troubleshooting)</h2>
<p>在构建过程中，你可能会遇到一些环境导致的问题（这些问题需通过终端输出判断）：</p>
<ol>
<li>
<p><strong>网络问题 (GitHub 访问)</strong></p>
<ul>
<li>
<p><strong>现象</strong>: <code>git clone</code> 或 <code>git submodule update</code> 速度极慢或失败。</p>
</li>
<li>
<p><strong>解决</strong>: <code>git</code> 需要配置代理或修改DNS和host文件（前者成功率高）才能正常访问 GitHub。</p>
</li>
</ul>
</li>
<li>
<p><strong>源问题 (apt / pip)</strong></p>
<ul>
<li>
<p><strong>现象</strong>: 执行 <code>ubuntu.sh</code> 脚本时，<code>apt-get install</code> 或 <code>pip install</code> 报错，提示无法下载某些包。</p>
</li>
<li>
<p><strong>解决</strong>: <code>apt</code> 和 <code>pip</code> 可能需要更换为国内的镜像源（如清华源、阿里源）。</p>
</li>
</ul>
</li>
<li>
<p><strong>构建卡住 (权限或依赖问题)</strong></p>
<ul>
<li>
<p><strong>现象</strong>: <code>make</code> 过程长时间卡住不动，或者报错退出。</p>
</li>
<li>
<p><strong>解决</strong>:</p>
<ul>
<li>
<p><strong>权限问题</strong>: 可能是某些脚本没有执行权限。</p>
</li>
<li>
<p><strong>重新构建</strong>: 有时构建过程会因意外中断而出错，可以尝试<strong>删除 <code>build</code> 目录</strong>或直接<strong>再次运行 <code>make px4_sitl_default gazebo</code> 命令</strong>。</p>
</li>
<li>
<p><strong>报错分析</strong>: 仔细查看终端输出。例如，之前我们遇到过的类似下面的报错，就是由于 Python 脚本执行失败导致的：</p>
</li>
</ul>
</li>
</ul>
</li>
</ol>
<hr />
<blockquote>
<p><strong>由于我们需要gazebo仿真中传感器的ROS话题，因此需要做Gazebo和ROS的桥接（PX4内部支持）</strong>
==仅当需要gazebo中传感器（如相机）的话题才需要，无人机的话题可由MAVROS桥接==</p>
</blockquote>
<h1 id="gazeboros">Gazebo和ROS的桥接</h1>
<h2 id="1-gazebo-ros">1. 安装 Gazebo-ROS 桥接包</h2>
<p>首先，需要安装 ROS Noetic 提供的用于 Gazebo 仿真的相关软件包：</p>
<div class="highlight"><pre><span></span><code>sudo<span class="w"> </span>apt-get<span class="w"> </span>install<span class="w"> </span>ros-noetic-gazebo-ros-pkgs<span class="w"> </span>ros-noetic-gazebo-ros-control
</code></pre></div>
<h2 id="2-sourcing">2. 设置环境变量 (Sourcing)</h2>
<p>在运行 ROS 和 Gazebo 仿真之前，需要正确设置环境变量。</p>
<h3 id="sourcing-ros">Sourcing ROS 环境</h3>
<p>首先，Sourcing 核心 ROS Noetic 环境(若已写入~/.bashrc，则无需再次运行）：</p>
<div class="highlight"><pre><span></span><code><span class="nb">source</span><span class="w"> </span>/opt/ros/noetic/setup.bash
</code></pre></div>
<h2 id="3-px4">3. 关键的 PX4 路径配置</h2>
<p>这是确保 PX4 SITL 能找到 Gazebo 11 (classic) 并与 ROS 正常通信的核心步骤。</p>
<blockquote>
<p><strong>注意：</strong> 以下命令建议在 <code>PX4-Autopilot</code>根目录位于<strong>用户主目录</strong> ，或者确保<strong>脚本路径正确</strong>。</p>
</blockquote>
<h3 id="31-sourcing-gazebo">3.1 Sourcing Gazebo 设置脚本</h3>
<p>PX4 提供了用于配置 Gazebo 的脚本。请注意 Gazebo 11 对应的路径是 <code>gazebo-classic</code>：</p>
<div class="highlight"><pre><span></span><code><span class="nb">source</span><span class="w"> </span>~/PX4-Autopilot/Tools/simulation/gazebo-classic/setup_gazebo.bash<span class="w"> </span>~/PX4-Autopilot<span class="w"> </span>~/PX4-Autopilot/build/px4_sitl_default
</code></pre></div>
<h3 id="32-ros-ros_package_path">3.2 配置 ROS 包路径 (ROS_PACKAGE_PATH)</h3>
<p>为了让 <code>roslaunch</code> 能够找到 <code>px4</code> 包（即 <code>mavros_posix_sitl.launch</code> 文件），需要将 <code>PX4-Autopilot</code> 根目录添加到 <code>ROS_PACKAGE_PATH</code>：</p>
<div class="highlight"><pre><span></span><code><span class="nb">export</span><span class="w"> </span><span class="nv">ROS_PACKAGE_PATH</span><span class="o">=</span><span class="nv">$ROS_PACKAGE_PATH</span>:~/PX4-Autopilot
</code></pre></div>
<p>（可选但推荐）将 <code>sitl_gazebo</code> 包也添加到路径中：</p>
<div class="highlight"><pre><span></span><code><span class="nb">export</span><span class="w"> </span><span class="nv">ROS_PACKAGE_PATH</span><span class="o">=</span><span class="nv">$ROS_PACKAGE_PATH</span>:~/PX4-Autopilot/Tools/simulation/gazebo-classic
</code></pre></div>
<h3 id="33-4bashrc">3.3 若第4步成功，可将以下内容写入~/.bashrc中（可选，强烈推荐）</h3>
<div class="highlight"><pre><span></span><code><span class="c1"># 请确保路径与您的实际安装路径一致</span>
<span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span>-d<span class="w"> </span>~/PX4-Autopilot<span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">  </span><span class="nb">source</span><span class="w"> </span>~/PX4-Autopilot/Tools/simulation/gazebo-classic/setup_gazebo.bash<span class="w"> </span>~/PX4-Autopilot<span class="w"> </span>~/PX4-Autopilot/build/px4_sitl_default
<span class="w">  </span><span class="nb">export</span><span class="w"> </span><span class="nv">ROS_PACKAGE_PATH</span><span class="o">=</span><span class="nv">$ROS_PACKAGE_PATH</span>:~/PX4-Autopilot
<span class="w">  </span><span class="nb">export</span><span class="w"> </span><span class="nv">ROS_PACKAGE_PATH</span><span class="o">=</span><span class="nv">$ROS_PACKAGE_PATH</span>:~/PX4-Autopilot/Tools/simulation/gazebo-classic
<span class="k">fi</span>
</code></pre></div>
<h2 id="4-gazeborosmavros">4. 启动仿真（以下步骤不仅能实现Gazebo与ROS话题桥接还可以同时启动MAVROS）</h2>
<p>配置完成后，可以使用 <code>roslaunch</code> 来启动 PX4 SITL、Gazebo 以及 MAVROS。</p>
<ul>
<li><strong>默认启动 (默认机型，默认世界)</strong>:
<div class="highlight"><pre><span></span><code>roslaunch<span class="w"> </span>px4<span class="w"> </span>mavros_posix_sitl.launch
</code></pre></div><blockquote>
<p><strong>注意：</strong> 特定模型和特定世界文件可分别在<code>PX4-Autopilot/Tools/simulation/gazebo-classic/sitl_gazebo-classic/models/</code>和<code>PX4-Autopilot/Tools/simulation/gazebo-classic/sitl_gazebo-classic/worlds/</code>找到。
==/home/colu要改成自己的用户路径==</p>
</blockquote>
</li>
<li><strong>指定特定无人机模型</strong>:
<div class="highlight"><pre><span></span><code>roslaunch<span class="w"> </span>px4<span class="w"> </span>mavros_posix_sitl.launch<span class="w"> </span>vehicle:<span class="o">=</span>iris_depth_camera
</code></pre></div></li>
<li><strong>指定特定世界文件</strong>:
<div class="highlight"><pre><span></span><code>roslaunch<span class="w"> </span>px4<span class="w"> </span>mavros_posix_sitl.launch<span class="w"> </span>vehicle:<span class="o">=</span>iris_depth_camera<span class="w"> </span>world:<span class="o">=</span>/home/colu/PX4-Autopilot/Tools/simulation/gazebo-classic/sitl_gazebo-classic/worlds/empty.world
</code></pre></div></li>
<li><strong>同时指定模型和世界</strong>:
<div class="highlight"><pre><span></span><code>roslaunch<span class="w"> </span>px4<span class="w"> </span>mavros_posix_sitl.launch<span class="w"> </span>vehicle:<span class="o">=</span>iris_depth_camera<span class="w"> </span>world:<span class="o">=</span>/home/colu/PX4-Autopilot/Tools/simulation/gazebo-classic/sitl_gazebo-classic/worlds/empty.world
</code></pre></div></li>
<li><strong>设置无人机初始位置</strong>
<div class="highlight"><pre><span></span><code>roslaunch<span class="w"> </span>px4<span class="w"> </span>mavros_posix_sitl.launch<span class="w"> </span>vehicle:<span class="o">=</span>iris_depth_camera<span class="w"> </span>world:<span class="o">=</span>/home/colu/PX4-Autopilot/Tools/simulation/gazebo-classic/sitl_gazebo-classic/worlds/empty.world<span class="w"> </span>x:<span class="o">=</span>-1<span class="w"> </span>y:<span class="o">=</span>-1<span class="w"> </span>z:<span class="o">=</span><span class="m">0</span>.1
</code></pre></div></li>
</ul>
<hr />
<blockquote>
<p>由于PX4没有提供拥有前视和下视相机的无人机模型，因此<strong>要么自己自定义</strong>，要么<strong>在PX4官方模型上修改</strong>两种选择。
<strong>注意</strong>：无人机模型才需要这么复杂，其他模型直接自定义就行
自定义较为复杂，因此这里着重讲述
以下都以官方的<code>iris_depth_camera</code>该无人机模型作为基准（不论自定义或修改）</p>
</blockquote>
<h1 id="px4">PX4 自定义模型仿真全流程总结</h1>
<h4 id="_1"><strong>核心理念：理解“身体”与“大脑”的分离</strong></h4>
<p>在PX4的仿真体系中，一个无人机模型由两个完全独立但又必须匹配的部分组成：</p>
<ol>
<li>
<p><strong>物理模型 (身体)</strong>：这是无人机在Gazebo仿真世界中的3D外观、物理属性（质量、惯性）和传感器配置。它由一个 <code>.sdf</code> 文件定义。Gazebo只关心这个“身体”。</p>
</li>
<li>
<p><strong>飞控配置 (大脑)</strong>：这是PX4固件内部的一个软件脚本，它告诉飞控软件如何为一个特定的机型配置参数（如PID、传感器校准）和加载哪些控制模块。PX4只关心这个“大脑”。</p>
</li>
</ol>
<blockquote>
<p>修改PX4官方模型只需修改Gazebo（身体）因为官方已经帮你创建了大脑；自定义则是两者都要
以下为已成功的自定义模型（同理可以将该模型替换官方模型，不过名字之类的要保留原样）
<a href="https://github.com/uuioop/px4_gazebo11">iris_front_down_camera</a></p>
</blockquote>
<hr />
<h3 id="_2"><strong>第一阶段：创建自定义模型 (三步走)</strong></h3>
<p>要成功启动自定义模型，必须完成以下三个核心步骤：</p>
<h4 id="1-the-body"><strong>步骤 1：创建物理模型 (The Body)</strong></h4>
<p>这是您为无人机在Gazebo中创建的3D实体。</p>
<ul>
<li>
<p><strong>位置</strong>：</p>
<div class="highlight"><pre><span></span><code>PX4-Autopilot/Tools/simulation/gazebo-classic/sitl_gazebo-classic/models/
</code></pre></div>
</li>
<li>
<p><strong>操作</strong>：</p>
<ol>
<li>
<p><strong>复制基础模型</strong>：复制一个现有的、工作正常的模型文件夹（例如 <code>iris_depth_camera</code>），并重命名为您自己的模型名称（例如 <code>iris_front_down_camera</code>）。</p>
</li>
<li>
<p><strong>重命名SDF文件</strong>：将文件夹内的 <code>.sdf</code> 或 <code>.sdf.jinja</code> 文件重命名以匹配文件夹名称（例如 <code>iris_front_down_camera.sdf</code>）。</p>
</li>
<li>
<p><strong>修改<code>model.config</code></strong>：打开 <code>model.config</code> 文件，将 <code>&lt;name&gt;</code> 标签内的名称修改为您的模型名。</p>
</li>
</ol>
</li>
</ul>
<blockquote>
<p>以官方模型为基础做修改的，到这就完成了，可以尝试<code>make px4_sitl gazebo-classic_iris_depth_camera</code>或<code>roslaunch px4 mavros_posix_sitl.launch vehicle:=iris_depth_camera</code>启动</p>
</blockquote>
<h4 id="2-the-brain"><strong>步骤 2：创建飞控配置 (The Brain)</strong></h4>
<p>这是为您的模型创建的软件配置文件，让PX4认识它。</p>
<ul>
<li>
<p><strong>位置</strong>：</p>
<div class="highlight"><pre><span></span><code>PX4-Autopilot/ROMFS/px4fmu_common/init.d-posix/airframes/
</code></pre></div>
</li>
<li>
<p><strong>操作</strong>：</p>
<ol>
<li>
<p><strong>创建新脚本</strong>：在此目录下创建一个新的脚本文件。</p>
</li>
<li>
<p><strong>遵循命名规则（关键！）</strong>：文件名必须遵循 <code>_gazebo-classic_[模型名]</code> 的格式。</p>
<ul>
<li>
<p>一个唯一的数字ID。官方建议自定义模型使用 <code>22000</code> 到 <code>22999</code> 之间的数字 1。</p>
</li>
<li>
<p><code>[模型名]</code>：与您在 <code>roslaunch</code> 命令中 <code>vehicle:=</code> 参数指定的值完全一致。</p>
</li>
<li>
<p><strong>示例</strong>：<code>22000_gazebo-classic_iris_front_down_camera</code></p>
</li>
</ul>
</li>
<li>
<p><strong>编写脚本内容</strong>：最简单的方式是复制一个现有脚本（如 <code>1015_gazebo-classic_iris_depth_camera</code>）的内容，并修改文件顶部的注释信息（如 <code>@name</code>），以描述您的新模型</p>
</li>
</ol>
</li>
</ul>
<h4 id="3px4"><strong>步骤 3：向PX4编译系统“注册”新模型</strong></h4>
<p>这是最容易被忽略但至关重要的一步。它告诉PX4的编译系统，在编译固件时要把您新创建的“大脑”打包进去。</p>
<ul>
<li>
<p><strong>位置</strong>：</p>
<div class="highlight"><pre><span></span><code>PX4-Autopilot/ROMFS/px4fmu_common/init.d-posix/airframes/CMakeLists.txt
</code></pre></div>
</li>
<li>
<p><strong>操作</strong>：</p>
<ol>
<li>
<p><strong>编辑CMakeLists.txt</strong>：打开这个文件，找到 <code>px4_add_romfs_files()</code> 函数。</p>
</li>
<li>
<p><strong>添加文件名</strong>：将您在步骤2中创建的脚本文件名（不带路径）添加到这个列表中。</p>
</li>
<li>
<p><strong>彻底重新编译</strong>：由于修改了编译系统的配置，必须执行一次“干净”的编译，才能让改动生效。
    <div class="highlight"><pre><span></span><code># 在 PX4-Autopilot 根目录下执行
make distclean
make px4_sitl_default gazebo-classic
</code></pre></div></p>
</li>
</ol>
</li>
</ul>
<p>完成这三步后，您的自定义模型就已经被完全集成到PX4系统中了。</p>
<blockquote>
<p>不能用<code>make px4_sitl (自定义模型)</code>启动--该命令专为官方模型设计，推荐用<code>roslaunch px4 mavros_posix_sitl.launch vehicle:=(更换成你的模型)</code></p>
</blockquote>
<hr />
<h3 id="_3"><strong>第二阶段：问题排查之旅</strong></h3>
<blockquote>
<p>可能会遇到些问题，先看看这边能不能解决
以下是论坛的讨论，有可能对你有帮助。否则就选择<strong>修改官方模型</strong>那个方法吧
<a href="https://discuss.px4.io/t/create-custom-model-for-sitl/6700/4">官方人员的流程</a>
<a href="https://discuss.px4.io/t/adding-custom-model-in-gazebo-classic/43858/2">社区讨论</a></p>
</blockquote>
<ol>
<li>
<p><strong>问题：<code>Segmentation fault (core dumped)</code> 或 <code>exit code 139</code></strong></p>
<ul>
<li>
<p><strong>现象</strong>：Gazebo仿真进程崩溃。</p>
</li>
<li>
<p><strong>原因</strong>：这是一个内存访问错误，通常由SDF模型文件中的<strong>插件配置错误</strong>或<strong>不稳定的模型结构</strong>引起。</p>
</li>
<li>
<p><strong>解决方案</strong>：</p>
<ul>
<li>
<p><strong>隔离排查</strong>：通过注释掉SDF中的可疑部分（例如某个相机插件），来定位导致崩溃的具体原因。</p>
</li>
<li>
<p><strong>最佳实践</strong>：放弃使用 <code>&lt;include&gt;</code> 方式来组合模型。创建一个<strong>完全自包含（self-contained）的SDF文件</strong>，将无人机机体、所有传感器和插件的完整定义都放在这一个文件中。这是最稳定、最推荐的做法。</p>
</li>
<li><strong>问题：<code>make px4_sitl gazebo-classic_...</code> 命令提示 <code>unknown target</code></strong></li>
</ul>
</li>
<li>
<p><strong>现象</strong>：使用 <code>make</code> 命令无法启动自定义模型，但可以启动官方模型（如 <code>iris_depth_camera</code>）。</p>
</li>
<li>
<p><strong>原因</strong>：<code>make px4_sitl...</code> 是一种为<strong>官方模型</strong>预设的快捷启动方式。您的自定义模型并未在编译系统中注册这样一个快捷目标。</p>
</li>
<li>
<p><strong>解决方案</strong>：这是正常现象。对于自定义模型，<strong>正确的启动方式是使用 <code>roslaunch</code></strong>，它不依赖于这些快捷目标。
    <div class="highlight"><pre><span></span><code>roslaunch px4 mavros_posix_sitl.launch vehicle:=iris_front_down_camera
</code></pre></div></p>
</li>
</ul>
</li>
</ol>
<hr />
<p><strong>关联: <a href="../4.%20%E4%BB%BF%E7%9C%9F%E4%B8%8E%E6%B5%8B%E8%AF%95/">4. 仿真与测试</a>, <a href="../PX4/">PX4</a></strong> <strong>返回: <a href="../">index</a></strong></p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  回到页面顶部
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "..", "features": ["navigation.tabs", "navigation.top", "search.suggest"], "search": "../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "\u5df2\u590d\u5236", "clipboard.copy": "\u590d\u5236", "search.result.more.one": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.other": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 # \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.term.missing": "\u7f3a\u5c11", "select.version": "\u9009\u62e9\u5f53\u524d\u7248\u672c"}, "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.f55a23d4.min.js"></script>
      
    
  </body>
</html>